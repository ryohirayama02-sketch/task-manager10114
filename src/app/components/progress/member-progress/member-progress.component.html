<div class="member-progress-container">
  <div class="header">
    <h2>{{ 'progress.members.title' | translate }}</h2>
    <p>
      {{ 'progress.members.description' | translate }}
    </p>

    <!-- 期間ボタン -->
    <div class="header-actions">
      <button mat-button class="period-button" (click)="openPeriodDialog()">
        <mat-icon>date_range</mat-icon>
        {{
          periodStartDate && periodEndDate
            ? (periodStartDate | date : 'MM/dd') + ' - ' + (periodEndDate | date : 'MM/dd')
            : periodStartDate
            ? (periodStartDate | date : 'MM/dd') + ' ' + ('progress.members.after' | translate)
            : periodEndDate
            ? (periodEndDate | date : 'MM/dd') + ' ' + ('progress.members.before' | translate)
            : ('progress.members.period' | translate)
        }}
      </button>
    </div>
  </div>

  <!-- ローディング表示 -->
  <div *ngIf="isLoading" class="loading-container">
    <mat-spinner></mat-spinner>
    <p>{{ 'progress.members.loading' | translate }}</p>
  </div>

  <!-- メンバー一覧 -->
  <div *ngIf="!isLoading && members.length > 0" class="members-list" [class.single-column]="languageService.getCurrentLanguage() === 'en'">
    <mat-card
      *ngFor="let member of members"
      class="member-card"
      (click)="goToMemberDetail(member.name)"
    >
      <mat-card-content>
        <div class="member-header">
          <h3 class="member-name">{{ member.name }}</h3>
          <span class="completion-rate"
            >{{ 'progress.members.completionRate' | translate }}: {{ member.completionRate }}%</span
          >
        </div>

        <!-- 優先度別タスク詳細 -->
        <div class="priority-breakdown">
          <div class="status-row priority-row">
            <div class="status-label">{{ 'progress.members.priority' | translate }}</div>
            <div class="status-total">&nbsp;</div>
            <div class="priority-details">
              <span class="priority-label high">{{ 'progress.priority.high' | translate }}</span>
              <span class="priority-label medium">{{ 'progress.priority.medium' | translate }}</span>
              <span class="priority-label low">{{ 'progress.priority.low' | translate }}</span>
            </div>
          </div>

          <div class="status-row completed">
            <div class="status-label">{{ 'progress.status.completed' | translate }}</div>
            <div class="status-total">{{ member.completedTasks }}{{ 'progress.members.count' | translate }}</div>
            <div class="priority-details">
              <div class="priority-item high">
                {{ member.completedByPriority.high }}
              </div>
              <div class="priority-item medium">
                {{ member.completedByPriority.medium }}
              </div>
              <div class="priority-item low">
                {{ member.completedByPriority.low }}
              </div>
            </div>
          </div>

          <div class="status-row in-progress">
            <div class="status-label">{{ 'progress.status.inProgress' | translate }}</div>
            <div class="status-total">{{ member.inProgressTasks }}{{ 'progress.members.count' | translate }}</div>
            <div class="priority-details">
              <div class="priority-item high">
                {{ member.inProgressByPriority.high }}
              </div>
              <div class="priority-item medium">
                {{ member.inProgressByPriority.medium }}
              </div>
              <div class="priority-item low">
                {{ member.inProgressByPriority.low }}
              </div>
            </div>
          </div>

          <div class="status-row not-started">
            <div class="status-label">{{ 'progress.status.notStarted' | translate }}</div>
            <div class="status-total">{{ member.notStartedTasks }}{{ 'progress.members.count' | translate }}</div>
            <div class="priority-details">
              <div class="priority-item high">
                {{ member.notStartedByPriority.high }}
              </div>
              <div class="priority-item medium">
                {{ member.notStartedByPriority.medium }}
              </div>
              <div class="priority-item low">
                {{ member.notStartedByPriority.low }}
              </div>
            </div>
          </div>
        </div>
      </mat-card-content>
    </mat-card>
  </div>

  <!-- メンバーがいない場合 -->
  <div *ngIf="!isLoading && members.length === 0" class="no-members">
    <mat-card>
      <mat-card-content>
        <div class="no-members-content">
          <h3>{{ 'progress.members.noMembers' | translate }}</h3>
          <p>{{ 'progress.members.noMembersDesc' | translate }}</p>
        </div>
      </mat-card-content>
    </mat-card>
  </div>
</div>
