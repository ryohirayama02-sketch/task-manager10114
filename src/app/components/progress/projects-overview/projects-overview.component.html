<div class="projects-overview-container">
  <div class="header">
    <h2>{{ 'progress.projects.title' | translate }}</h2>
    <div class="header-actions">
      <button
        mat-stroked-button
        color="primary"
        [matMenuTriggerFor]="sortMenu"
        class="sort-button"
      >
        <mat-icon>sort</mat-icon>
        {{ 'progress.projects.sortBy' | translate }}: {{ getSortLabel(sortOption) }}
        <mat-icon class="expand-icon">arrow_drop_down</mat-icon>
      </button>
      <button mat-raised-button color="primary" (click)="openProjectForm()">
        <mat-icon>add</mat-icon>
        {{ 'progress.projects.createProject' | translate }}
      </button>
    </div>
  </div>

  <mat-menu #sortMenu="matMenu">
    <button
      mat-menu-item
      *ngFor="let option of sortOptions"
      (click)="onSortChange(option.value)"
    >
      <span>{{ option.label }}</span>
      <mat-icon class="selected-icon" *ngIf="sortOption === option.value">
        check
      </mat-icon>
    </button>
  </mat-menu>

  <!-- ▼ プロジェクトカード一覧 -->
  <div class="project-card-list">
    <div
      *ngFor="let project of projects"
      (click)="project.id ? goToProgress(project.id) : null"
      class="project-card"
      [ngStyle]="{ '--project-theme-color': getProjectThemeColor(project) }"
      [class.completed]="
        project.id &&
        projectProgress[project.id] &&
        projectProgress[project.id].progressPercentage === 100
      "
    >
      <div class="project-info">
        <!-- ▼ プロジェクト名クリックで詳細へ -->
        <h3 class="project-title">
          {{ formatProjectName(project.projectName) }}
        </h3>

        <p class="project-overview">
          <strong>{{ 'progress.projects.overview' | translate }}:</strong>
          <span class="info-text">
            {{ project.overview || "（概要未設定）" }}
          </span>
        </p>
        <p class="project-meta-line">
          <strong>{{ 'progress.projects.period' | translate }}:</strong>
          <span class="info-text">
            {{ toDateDisplay(project.startDate) }} -
            {{ toDateDisplay(project.endDate) }}
          </span>
        </p>
        <p class="project-meta-line">
          <strong>{{ 'progress.projects.responsible' | translate }}:</strong>
          <span class="info-text">
            {{ getResponsiblesDisplay(project) }}
          </span>
        </p>
        <p class="project-meta-line">
          <strong>{{ 'progress.projects.members' | translate }}:</strong>
          <span class="info-text">
            {{ getMemberDisplay(project) }}
          </span>
        </p>
      </div>

      <!-- ▼ 進捗率円グラフ -->
      <div
        class="progress-section"
        *ngIf="project.id && projectProgress[project.id]"
        [style.opacity]="
          projectProgress[project.id].progressPercentage === 100 ? '0.6' : '1'
        "
      >
        <app-progress-circle
          [percentage]="projectProgress[project.id].progressPercentage"
          [completedTasks]="projectProgress[project.id].completedTasks"
          [totalTasks]="projectProgress[project.id].totalTasks"
          [size]="80"
          [strokeWidth]="6"
        >
        </app-progress-circle>
      </div>
    </div>
  </div>
</div>
