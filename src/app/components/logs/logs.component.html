<div class="logs-container">
  <div class="logs-header">
    <h2>編集ログ</h2>
    <button
      class="csv-export-btn"
      (click)="exportToCSV()"
      [disabled]="editLogs.length === 0"
    >
      📊 CSV出力
    </button>
  </div>

  <!-- フィルター -->
  <div class="logs-filters" *ngIf="!loading">
    <div class="filter-group">
      <mat-form-field appearance="outline" class="filter-field">
        <mat-label>プロジェクト</mat-label>
        <mat-select
          multiple
          [(ngModel)]="filterProjects"
          name="projectFilter"
          (ngModelChange)="onProjectFilterChange()"
        >
          <mat-option *ngFor="let project of projectOptions" [value]="project">
            {{ project }}
          </mat-option>
        </mat-select>
      </mat-form-field>
    </div>

    <div class="filter-group">
      <mat-form-field appearance="outline" class="filter-field">
        <mat-label>タスク</mat-label>
        <mat-select
          multiple
          [(ngModel)]="filterTasks"
          name="taskFilter"
          (ngModelChange)="onTaskFilterChange()"
        >
          <mat-option *ngFor="let task of taskOptions" [value]="task">
            {{ task }}
          </mat-option>
        </mat-select>
      </mat-form-field>
    </div>

    <div class="filter-group">
      <mat-form-field appearance="outline" class="filter-field">
        <mat-label>メンバー</mat-label>
        <mat-select
          multiple
          [(ngModel)]="filterMembers"
          name="memberFilter"
          (ngModelChange)="onMemberFilterChange()"
        >
          <mat-option *ngFor="let member of memberOptions" [value]="member">
            {{ member }}
          </mat-option>
        </mat-select>
      </mat-form-field>
    </div>

    <div class="filter-actions">
      <button type="button" class="period-btn" (click)="openPeriodDialog()">
        📅 {{ periodLabel() }}
      </button>
      <button
        type="button"
        class="reset-btn"
        (click)="resetFilters()"
        [disabled]="!isFilterActive()"
      >
        リセット
      </button>
    </div>
  </div>

  <!-- ローディング表示 -->
  <div *ngIf="loading" class="loading">
    <p>読み込み中...</p>
  </div>

  <!-- ログ一覧 -->
  <div *ngIf="!loading && editLogs.length > 0" class="logs-list">
    <div *ngFor="let log of editLogs; trackBy: trackByLogId" class="log-item">
      <div class="log-header">
        <span class="log-date">{{ formatDate(log.createdAt) }}</span>
        <span class="log-action" [class]="'action-' + log.action">
          {{ getActionLabel(log.action) }}
        </span>
      </div>

      <div class="log-content">
        <div class="log-user">
          <strong>👤 {{ log.userName }}</strong>
        </div>

        <div class="log-project">
          <strong>📁 プロジェクト:</strong> {{ log.projectName }}
        </div>

        <div *ngIf="log.taskName" class="log-task">
          <strong>📝 タスク:</strong> {{ log.taskName }}
        </div>

        <div class="log-description">
          <strong>📋 変更内容:</strong> {{ log.changeDescription }}
        </div>

        <div *ngIf="log.oldValue || log.newValue" class="log-changes">
          <div *ngIf="log.oldValue" class="change-old">
            <strong>変更前:</strong> {{ log.oldValue }}
          </div>
          <div *ngIf="log.newValue" class="change-new">
            <strong>変更後:</strong> {{ log.newValue }}
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- ログが無い場合 -->
  <div *ngIf="!loading && editLogs.length === 0" class="no-logs">
    <p>編集ログがありません</p>
  </div>

  <!-- さらに読み込みボタン -->
  <div *ngIf="!loading && hasMoreLogs && editLogs.length > 0" class="load-more">
    <button class="load-more-btn" (click)="loadMoreLogs()">
      📄 さらに読み込む
    </button>
  </div>
</div>
