<div class="logs-container">
  <div class="logs-header">
    <h2>{{ 'logs.title' | translate }}</h2>
    <button
      class="csv-export-btn"
      (click)="exportToCSV()"
      [disabled]="editLogs.length === 0"
    >
      ğŸ“Š {{ 'logs.csvExport' | translate }}
    </button>
  </div>

  <!-- ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ -->
  <div class="logs-filters" *ngIf="!loading">
    <div class="filter-group">
      <mat-form-field appearance="outline" class="filter-field">
        <mat-select
          multiple
          [(ngModel)]="filterProjects"
          name="projectFilter"
          (ngModelChange)="onProjectFilterChange()"
          [placeholder]="'logs.filterProject' | translate"
        >
          <mat-option *ngFor="let project of projectOptions" [value]="project">
            {{ project }}
          </mat-option>
        </mat-select>
      </mat-form-field>
    </div>

    <div class="filter-group">
      <mat-form-field appearance="outline" class="filter-field">
        <mat-select
          multiple
          [(ngModel)]="filterTasks"
          name="taskFilter"
          (ngModelChange)="onTaskFilterChange()"
          [placeholder]="'logs.filterTask' | translate"
        >
          <mat-option *ngFor="let task of taskOptions" [value]="task">
            {{ task }}
          </mat-option>
        </mat-select>
      </mat-form-field>
    </div>

    <div class="filter-group">
      <mat-form-field appearance="outline" class="filter-field">
        <mat-select
          multiple
          [(ngModel)]="filterMembers"
          name="memberFilter"
          (ngModelChange)="onMemberFilterChange()"
          [placeholder]="'logs.filterMember' | translate"
        >
          <mat-option *ngFor="let member of memberOptions" [value]="member">
            {{ member }}
          </mat-option>
        </mat-select>
      </mat-form-field>
    </div>

    <div class="filter-actions period-filters">
      <mat-form-field appearance="outline" class="period-field">
        <input
          matInput
          [matDatepicker]="periodStartDatePicker"
          [(ngModel)]="periodStartDateObj"
          (dateChange)="onPeriodStartDateChange()"
          [max]="periodEndDateObj || maxDate"
          [ngModelOptions]="{standalone: true}"
          readonly
          [placeholder]="'progress.member.periodDialog.startDate' | translate"
        />
        <mat-datepicker-toggle matIconSuffix [for]="periodStartDatePicker"></mat-datepicker-toggle>
        <mat-datepicker #periodStartDatePicker></mat-datepicker>
      </mat-form-field>

      <mat-form-field appearance="outline" class="period-field">
        <input
          matInput
          [matDatepicker]="periodEndDatePicker"
          [(ngModel)]="periodEndDateObj"
          (dateChange)="onPeriodEndDateChange()"
          [min]="periodStartDateObj || undefined"
          [max]="maxDate"
          [ngModelOptions]="{standalone: true}"
          readonly
          [placeholder]="'progress.member.periodDialog.endDate' | translate"
        />
        <mat-datepicker-toggle matIconSuffix [for]="periodEndDatePicker"></mat-datepicker-toggle>
        <mat-datepicker #periodEndDatePicker></mat-datepicker>
      </mat-form-field>

      <button mat-button (click)="resetPeriodFilter()" *ngIf="periodStartDateObj || periodEndDateObj">
        <mat-icon>clear</mat-icon>
        {{ 'progress.member.periodDialog.reset' | translate }}
      </button>

      <button
        type="button"
        class="reset-btn"
        (click)="resetFilters()"
        [disabled]="!isFilterActive()"
      >
        {{ 'logs.reset' | translate }}
      </button>
    </div>
  </div>

  <!-- ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¡¨ç¤º -->
  <div *ngIf="loading" class="loading">
    <p>{{ 'logs.loadingText' | translate }}</p>
  </div>

  <!-- ãƒ­ã‚°ä¸€è¦§ -->
  <div *ngIf="!loading && editLogs.length > 0" class="logs-list">
    <div *ngFor="let log of editLogs; trackBy: trackByLogId" class="log-item">
      <div class="log-header">
        <span class="log-date">{{ formatDate(log.createdAt) }}</span>
        <span class="log-action" [class]="'action-' + log.action">
          {{ getActionLabel(log.action) }}
        </span>
      </div>

      <div class="log-content">
        <div class="log-user">
          <strong>ğŸ‘¤ {{ getUserNameDisplay(log) }}</strong>
        </div>

        <div class="log-project">
          <strong>ğŸ“ {{ 'logs.project' | translate }}</strong>{{ log.projectName }}
        </div>

        <div *ngIf="log.taskName" class="log-task">
          <strong>ğŸ“ {{ 'logs.task' | translate }}</strong>{{ log.taskName }}
        </div>

        <div class="log-description">
          <strong>ğŸ“‹ {{ 'logs.changeDescription' | translate }}</strong>{{ formatChangeDescription(log) }}
        </div>

      </div>
    </div>
  </div>

  <!-- ãƒ­ã‚°ãŒç„¡ã„å ´åˆ -->
  <div *ngIf="!loading && editLogs.length === 0" class="no-logs">
    <p>{{ 'logs.noEditLogs' | translate }}</p>
  </div>

  <!-- ã•ã‚‰ã«èª­ã¿è¾¼ã¿ãƒœã‚¿ãƒ³ -->
  <div *ngIf="!loading && hasMoreLogs && editLogs.length > 0" class="load-more">
    <button class="load-more-btn" (click)="loadMoreLogs()">
      ğŸ“„ {{ 'logs.loadMore' | translate }}
    </button>
  </div>
</div>
