<h2>ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼å¼èª²é¡Œç®¡ç†</h2>

<!-- ã‚ªãƒ•ãƒ©ã‚¤ãƒ³æ™‚ã®ã‚¿ã‚¹ã‚¯è¿½åŠ ãƒœã‚¿ãƒ³ -->
<div *ngIf="!isOnline" class="offline-task-add">
  <button mat-raised-button color="primary" (click)="openOfflineTaskDialog()">
    <mat-icon>add</mat-icon>
    ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ã§ã‚¿ã‚¹ã‚¯è¿½åŠ 
  </button>
  <p class="offline-note">ã‚ªãƒ•ãƒ©ã‚¤ãƒ³æ™‚ã¯ç°¡æ˜“çš„ãªã‚¿ã‚¹ã‚¯è¿½åŠ ã®ã¿å¯èƒ½ã§ã™</p>
</div>

<!-- ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆé¸æŠã¨ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ -->
<div class="controls-section">
  <div class="project-selector">
    <h3>è¡¨ç¤ºã™ã‚‹ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’é¸æŠ</h3>
    <div class="project-checkboxes">
      <mat-checkbox
        *ngFor="let project of projects"
        [checked]="project.id ? isProjectSelected(project.id) : false"
        (change)="project.id ? toggleProjectSelection(project.id) : null"
        class="project-checkbox"
      >
        {{ project.projectName }}
      </mat-checkbox>
    </div>
  </div>

  <!-- ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ -->
  <div class="filter-section">
    <mat-form-field appearance="outline" style="width: 150px">
      <mat-label>å„ªå…ˆåº¦</mat-label>
      <mat-select
        [(ngModel)]="filterPriority"
        (selectionChange)="applyFilters()"
      >
        <mat-option value="">ã™ã¹ã¦</mat-option>
        <mat-option value="é«˜">é«˜</mat-option>
        <mat-option value="ä¸­">ä¸­</mat-option>
        <mat-option value="ä½">ä½</mat-option>
      </mat-select>
    </mat-form-field>

    <mat-form-field appearance="outline" style="width: 150px">
      <mat-label>æ‹…å½“è€…</mat-label>
      <mat-select
        [(ngModel)]="filterAssignee"
        (selectionChange)="applyFilters()"
      >
        <mat-option value="">ã™ã¹ã¦</mat-option>
        <mat-option
          *ngFor="let assignee of getUniqueAssignees()"
          [value]="assignee"
        >
          {{ assignee }}
        </mat-option>
      </mat-select>
    </mat-form-field>

    <mat-form-field appearance="outline" style="width: 150px">
      <mat-label>ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</mat-label>
      <mat-select [(ngModel)]="filterStatus" (selectionChange)="applyFilters()">
        <mat-option value="">ã™ã¹ã¦</mat-option>
        <mat-option value="æœªç€æ‰‹">æœªç€æ‰‹</mat-option>
        <mat-option value="ä½œæ¥­ä¸­">ä½œæ¥­ä¸­</mat-option>
        <mat-option value="å®Œäº†">å®Œäº†</mat-option>
      </mat-select>
    </mat-form-field>

    <button mat-button (click)="resetFilters()">ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ãƒªã‚»ãƒƒãƒˆ</button>
  </div>
</div>

<!-- ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ -->
<div class="action-buttons">
  <div class="view-controls">
    <mat-button-toggle-group
      name="viewMode"
      [(ngModel)]="viewMode"
      (change)="changeViewMode($event.value)"
    >
      <mat-button-toggle value="day">æ—¥</mat-button-toggle>
      <mat-button-toggle value="week">é€±</mat-button-toggle>
      <mat-button-toggle value="month">æœˆ</mat-button-toggle>
    </mat-button-toggle-group>
  </div>
  <button mat-raised-button color="primary" (click)="openProjectDialog()">
    + ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ
  </button>
</div>

<!-- ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ -->
<div class="calendar-container">
  <!-- ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ãƒ˜ãƒƒãƒ€ãƒ¼ -->
  <div class="calendar-header">
    <button mat-icon-button (click)="changeDate(-1)">
      <mat-icon>chevron_left</mat-icon>
    </button>
    <h3>{{ getDisplayName() }}</h3>
    <button mat-icon-button (click)="changeDate(1)">
      <mat-icon>chevron_right</mat-icon>
    </button>
    <button mat-button (click)="goToCurrentDate()">ä»Šæ—¥</button>
  </div>

  <!-- ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã‚°ãƒªãƒƒãƒ‰ -->
  <div class="calendar-grid" [ngClass]="'view-' + viewMode">
    <!-- æ›œæ—¥ãƒ˜ãƒƒãƒ€ãƒ¼ï¼ˆæœˆè¡¨ç¤ºã®ã¿ï¼‰ -->
    <ng-container *ngIf="viewMode === 'month'">
      <div *ngFor="let day of weekDays" class="week-day">{{ day }}</div>
    </ng-container>

    <div
      *ngFor="let date of calendarDays"
      class="calendar-day"
      [ngClass]="{
        today: isToday(date),
        'other-month': !isCurrentMonth(date) && viewMode === 'month',
        selected: isSelectedDate(date)
      }"
      (click)="onDateSelected(date)"
    >
      <div class="day-number">
        {{ date.getDate() }}
        <!-- ãƒã‚¤ãƒ«ã‚¹ãƒˆãƒ¼ãƒ³è¡¨ç¤º -->
        <div
          *ngFor="let milestone of getMilestonesForDate(date)"
          class="milestone-flag"
          (mouseenter)="showMilestoneTooltip($event, milestone)"
          (mouseleave)="hideMilestoneTooltip()"
        >
          ğŸš©
        </div>
      </div>
      <div class="day-tasks">
        <div
          *ngFor="let task of getTasksForDate(date)"
          class="task-item"
          [style.background-color]="statusColors[task.status]"
          [title]="
            task.taskName + ' (' + task.status + ') - æœŸé™: ' + task.dueDate
          "
          (click)="openTaskDetail(task)"
        >
          <div class="task-name">{{ task.taskName }}</div>
          <div class="task-project">{{ task.projectName }}</div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- å‡¡ä¾‹ -->
<div class="legend">
  <h4>ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</h4>
  <div class="legend-items">
    <div class="legend-item">
      <div class="legend-color" style="background-color: #ffcdd2"></div>
      <span>æœªç€æ‰‹</span>
    </div>
    <div class="legend-item">
      <div class="legend-color" style="background-color: #bbdefb"></div>
      <span>ä½œæ¥­ä¸­</span>
    </div>
    <div class="legend-item">
      <div class="legend-color" style="background-color: #c8e6c9"></div>
      <span>å®Œäº†</span>
    </div>
  </div>
</div>

<!-- ã‚«ã‚¹ã‚¿ãƒ ãƒ„ãƒ¼ãƒ«ãƒãƒƒãƒ— -->
<div
  *ngIf="tooltipVisible"
  class="milestone-tooltip"
  [style.left.px]="tooltipPosition.x"
  [style.top.px]="tooltipPosition.y"
>
  <div class="tooltip-header">
    <span class="tooltip-icon">ğŸš©</span>
    <span class="tooltip-title">ãƒã‚¤ãƒ«ã‚¹ãƒˆãƒ¼ãƒ³</span>
  </div>
  <div class="tooltip-content">
    <div class="tooltip-project">{{ tooltipMilestone?.projectName }}</div>
    <div class="tooltip-name">{{ tooltipMilestone?.name }}</div>
    <div class="tooltip-date">
      {{ tooltipMilestone?.date | date : "yyyy/MM/dd" }}
    </div>
  </div>
  <div class="tooltip-arrow"></div>
</div>
