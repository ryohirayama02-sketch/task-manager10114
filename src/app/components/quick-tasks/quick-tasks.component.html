<div class="quick-tasks-container">
  <!-- ヘッダー -->
  <div class="header">
    <h1>{{ "quickTasks.title" | translate }}</h1>
    <div class="filter-controls">
      <mat-form-field appearance="outline" class="days-filter">
        <mat-label>{{ "quickTasks.dueDate" | translate }}</mat-label>
        <mat-select
          [(value)]="daysFilter"
          (selectionChange)="onDaysFilterChange()"
        >
          <mat-option *ngFor="let days of daysOptions" [value]="days">
            {{ days }}{{ "quickTasks.daysSuffix" | translate }}
          </mat-option>
        </mat-select>
      </mat-form-field>
      <!-- 一時的にデバッグボタンを有効化 -->
      <button mat-button color="accent" (click)="toggleDebugMode()">
        <mat-icon>bug_report</mat-icon>
        {{
          debugMode
            ? ("quickTasks.debugOff" | translate)
            : ("quickTasks.debugOn" | translate)
        }}
      </button>
    </div>
  </div>

  <!-- ローディング表示 -->
  <div *ngIf="loading" class="loading-container">
    <mat-spinner diameter="50"></mat-spinner>
    <p>{{ "quickTasks.loading" | translate }}</p>
  </div>

  <!-- 一時的にデバッグ情報を有効化 -->
  <div *ngIf="debugMode && !loading" class="debug-container">
    <h3>{{ "quickTasks.debugInfo" | translate }}</h3>
    <div class="debug-info">
      <p>
        <strong>{{ "quickTasks.totalTasks" | translate }}</strong>
        {{ allTasks.length }}{{ "progress.members.count" | translate }}
      </p>
      <p>
        <strong>{{ "quickTasks.userRelatedTasks" | translate }}</strong>
        {{ filteredTasks.length }}{{ "progress.members.count" | translate }}
      </p>
      <p *ngIf="currentUser">
        <strong>{{ "quickTasks.currentUser" | translate }}</strong>
        {{ currentUser.email }} ({{ currentUser.displayName }})
      </p>

      <div *ngIf="filteredTasks.length > 0" class="debug-tasks">
        <h4>{{ "quickTasks.userRelatedTasksList" | translate }}</h4>
        <div class="tasks-grid">
          <mat-card
            *ngFor="let task of filteredTasks; trackBy: trackByTaskId"
            class="task-card debug-task-card"
            [ngClass]="getDueStatusClass(task)"
            (click)="onTaskClick(task)"
          >
            <!-- タスクヘッダー -->
            <mat-card-header>
              <div class="task-header">
                <h3 class="task-title">{{ task.taskName }}</h3>
                <div class="task-badges">
                  <mat-chip
                    class="status-chip"
                    [ngClass]="'status-' + task.status"
                    selected
                  >
                    {{ task.status }}
                  </mat-chip>
                  <mat-chip
                    class="priority-chip"
                    [ngClass]="'priority-' + task.priority"
                    selected
                  >
                    {{ task.priority }}
                  </mat-chip>
                </div>
              </div>
            </mat-card-header>

            <!-- タスク内容 -->
            <mat-card-content>
              <div class="task-info">
                <div class="project-info">
                  <span>{{ "quickTasks.projectName" | translate }}</span>
                  <span class="project-name-pill">
                    {{ formatProjectName(task.projectName) }}
                  </span>
                </div>

                <div class="due-date-info">
                  <span>{{ "quickTasks.dueDateLabel" | translate }}</span>
                  <span>{{ task.dueDate }}</span>
                  <span class="days-until" *ngIf="!isOverdue(task.dueDate)">
                    ({{ getDaysUntilDue(task.dueDate)
                    }}{{ "quickTasks.daysAfter" | translate }})
                  </span>
                  <span class="days-until" *ngIf="isOverdue(task.dueDate)">
                    ({{ getAbsoluteValue(getDaysUntilDue(task.dueDate))
                    }}{{ "quickTasks.daysOverdue" | translate }})
                  </span>
                </div>
              </div>
            </mat-card-content>
          </mat-card>
        </div>
      </div>

      <div
        *ngIf="filteredTasks.length === 0 && allTasks.length > 0"
        class="debug-no-user-tasks"
      >
        <h4>{{ "quickTasks.noUserTasksFound" | translate }}</h4>
        <p>{{ "quickTasks.checkAllTaskAssignees" | translate }}</p>
        <div *ngFor="let task of allTasks; let i = index" class="debug-task">
          <strong>{{ i + 1 }}.</strong> {{ task.taskName }}
          <span class="debug-details">
            ({{ "quickTasks.assignee" | translate }}
            {{ getTaskAssigneeDisplay(task) }},
            {{ "quickTasks.assigneeEmail" | translate }}
            {{ task.assigneeEmail }})
          </span>
        </div>
      </div>
    </div>
  </div>

  <!-- タスク一覧（デバッグモード時は非表示） -->
  <div *ngIf="!loading && !debugMode" class="tasks-container">
    <!-- タスクが見つからない場合 -->
    <div *ngIf="filteredTasks.length === 0" class="no-tasks">
      <mat-icon>task_alt</mat-icon>
      <h3>{{ "quickTasks.noTasksFound" | translate }}</h3>
      <p>
        {{ daysFilter }}{{ "quickTasks.daysSuffix" | translate
        }}{{ "quickTasks.noTasksFoundDesc" | translate }}
      </p>
    </div>

    <!-- タスクカード一覧 -->
    <div *ngIf="filteredTasks.length > 0" class="tasks-grid">
      <mat-card
        *ngFor="let task of filteredTasks; trackBy: trackByTaskId"
        class="task-card"
        [ngClass]="getDueStatusClass(task)"
        (click)="onTaskClick(task)"
      >
        <!-- タスクヘッダー -->
        <mat-card-header>
          <div class="task-header">
            <h3 class="task-title">{{ task.taskName }}</h3>
            <div class="task-badges">
              <mat-chip
                class="status-chip"
                [ngClass]="'status-' + task.status"
                selected
              >
                {{ task.status }}
              </mat-chip>
              <mat-chip
                class="priority-chip"
                [ngClass]="'priority-' + task.priority"
                selected
              >
                {{ task.priority }}
              </mat-chip>
            </div>
          </div>
        </mat-card-header>

        <!-- タスク内容 -->
        <mat-card-content>
          <div class="task-info">
            <div class="project-info">
              <span>{{ "quickTasks.projectName" | translate }}</span>
              <span class="project-name-pill">
                {{ formatProjectName(task.projectName) }}
              </span>
            </div>

            <div class="due-date-info">
              <span>{{ "quickTasks.dueDateLabel" | translate }}</span>
              <span>{{ task.dueDate }}</span>
              <span class="days-until" *ngIf="!isOverdue(task.dueDate)">
                ({{ getDaysUntilDue(task.dueDate)
                }}{{ "quickTasks.daysAfter" | translate }})
              </span>
              <span class="days-until" *ngIf="isOverdue(task.dueDate)">
                ({{ getAbsoluteValue(getDaysUntilDue(task.dueDate))
                }}{{ "quickTasks.daysOverdue" | translate }})
              </span>
            </div>
          </div>
        </mat-card-content>
      </mat-card>
    </div>
  </div>
</div>
