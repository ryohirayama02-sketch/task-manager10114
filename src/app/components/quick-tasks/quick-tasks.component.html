<div class="quick-tasks-container">
  <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
  <div class="header">
    <h1>{{ "quickTasks.title" | translate }}</h1>
    <div class="filter-controls">
      <mat-form-field appearance="outline" class="days-filter">
        <mat-label>{{ "quickTasks.dueDate" | translate }}</mat-label>
        <mat-select
          [(value)]="daysFilter"
          (selectionChange)="onDaysFilterChange()"
        >
          <mat-option *ngFor="let days of daysOptions" [value]="days">
            {{ days }}{{ "quickTasks.daysSuffix" | translate }}
          </mat-option>
        </mat-select>
      </mat-form-field>
      <!-- ä¸€æ™‚çš„ã«ãƒ‡ãƒãƒƒã‚°ãƒœã‚¿ãƒ³ã‚’æœ‰åŠ¹åŒ– -->
      <button mat-button color="accent" (click)="toggleDebugMode()">
        <mat-icon>bug_report</mat-icon>
        {{
          debugMode
            ? ("quickTasks.debugOff" | translate)
            : ("quickTasks.debugOn" | translate)
        }}
      </button>
    </div>
  </div>

  <!-- ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¡¨ç¤º -->
  <div *ngIf="loading" class="loading-container">
    <mat-spinner diameter="50"></mat-spinner>
    <p>{{ "quickTasks.loading" | translate }}</p>
  </div>

  <!-- ä¸€æ™‚çš„ã«ãƒ‡ãƒãƒƒã‚°æƒ…å ±ã‚’æœ‰åŠ¹åŒ– -->
  <div *ngIf="debugMode && !loading" class="debug-container">
    <h3>ğŸ” ãƒ‡ãƒãƒƒã‚°æƒ…å ±</h3>
    <div class="debug-info">
      <p><strong>å…¨ã‚¿ã‚¹ã‚¯æ•°:</strong> {{ allTasks.length }}ä»¶</p>
      <p>
        <strong>ç¾åœ¨ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«é–¢é€£ã™ã‚‹ã‚¿ã‚¹ã‚¯æ•°:</strong>
        {{ filteredTasks.length }}ä»¶
      </p>
      <p *ngIf="currentUser">
        <strong>ç¾åœ¨ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼:</strong> {{ currentUser.email }} ({{
          currentUser.displayName
        }})
      </p>

      <div *ngIf="filteredTasks.length > 0" class="debug-tasks">
        <h4>ç¾åœ¨ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«é–¢é€£ã™ã‚‹ã‚¿ã‚¹ã‚¯ä¸€è¦§:</h4>
        <div class="tasks-grid">
          <mat-card
            *ngFor="let task of filteredTasks; trackBy: trackByTaskId"
            class="task-card debug-task-card"
            [ngClass]="getDueStatusClass(task)"
            (click)="onTaskClick(task)"
          >
            <!-- ã‚¿ã‚¹ã‚¯ãƒ˜ãƒƒãƒ€ãƒ¼ -->
            <mat-card-header>
              <div class="task-header">
                <h3 class="task-title">{{ task.taskName }}</h3>
                <div class="task-badges">
                  <mat-chip
                    class="priority-chip"
                    [ngClass]="'priority-' + task.priority"
                    selected
                  >
                    {{ task.priority }}
                  </mat-chip>
                  <mat-chip
                    class="status-chip"
                    [ngClass]="'status-' + task.status"
                    selected
                  >
                    {{ task.status }}
                  </mat-chip>
                </div>
              </div>
            </mat-card-header>

            <!-- ã‚¿ã‚¹ã‚¯å†…å®¹ -->
            <mat-card-content>
              <div class="task-info">
                <div class="project-info">
                  <mat-icon>folder</mat-icon>
                  <span
                    class="project-name-pill"
                    [ngStyle]="getProjectNameStyle(task)"
                  >
                    {{ task.projectName }}
                  </span>
                </div>

                <div class="assignee-info">
                  <mat-icon>person</mat-icon>
                  <span>{{ task.assignee }}</span>
                </div>

                <div
                  class="due-date-info"
                  [class.overdue]="isOverdue(task.dueDate)"
                  [class.due-today]="getDaysUntilDue(task.dueDate) === 0"
                  [class.due-tomorrow]="getDaysUntilDue(task.dueDate) === 1"
                  [class.due-soon]="isDueSoon(task.dueDate)"
                >
                  <mat-icon>schedule</mat-icon>
                  <span>{{ task.dueDate }}</span>
                  <span class="days-until" *ngIf="!isOverdue(task.dueDate)">
                    ({{ getDaysUntilDue(task.dueDate) }}æ—¥å¾Œ)
                  </span>
                  <span
                    class="days-until overdue-text"
                    *ngIf="isOverdue(task.dueDate)"
                  >
                    ({{
                      getAbsoluteValue(getDaysUntilDue(task.dueDate))
                    }}æ—¥é…ã‚Œ)
                  </span>
                </div>
              </div>
            </mat-card-content>
          </mat-card>
        </div>
      </div>

      <div
        *ngIf="filteredTasks.length === 0 && allTasks.length > 0"
        class="debug-no-user-tasks"
      >
        <h4>âš ï¸ ç¾åœ¨ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«é–¢é€£ã™ã‚‹ã‚¿ã‚¹ã‚¯ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“</h4>
        <p>å…¨ã‚¿ã‚¹ã‚¯ã®æ‹…å½“è€…æƒ…å ±ã‚’ç¢ºèªã—ã¦ãã ã•ã„ï¼š</p>
        <div *ngFor="let task of allTasks; let i = index" class="debug-task">
          <strong>{{ i + 1 }}.</strong> {{ task.taskName }}
          <span class="debug-details">
            (æ‹…å½“è€…: {{ task.assignee }}, æ‹…å½“è€…ãƒ¡ãƒ¼ãƒ«:
            {{ task.assigneeEmail }})
          </span>
        </div>
      </div>
    </div>
  </div>

  <!-- ã‚¿ã‚¹ã‚¯ä¸€è¦§ï¼ˆãƒ‡ãƒãƒƒã‚°ãƒ¢ãƒ¼ãƒ‰æ™‚ã¯éè¡¨ç¤ºï¼‰ -->
  <div *ngIf="!loading && !debugMode" class="tasks-container">
    <!-- ã‚¿ã‚¹ã‚¯ãŒè¦‹ã¤ã‹ã‚‰ãªã„å ´åˆ -->
    <div *ngIf="filteredTasks.length === 0" class="no-tasks">
      <mat-icon>task_alt</mat-icon>
      <h3>{{ "quickTasks.noTasksFound" | translate }}</h3>
      <p>
        {{ daysFilter
        }}{{
          "quickTasks.daysSuffix" | translate
        }}ä»¥å†…ã«æœŸé™ãŒæ¥ã‚‹æœªå®Œäº†ã®ã‚¿ã‚¹ã‚¯ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚
      </p>
    </div>

    <!-- ã‚¿ã‚¹ã‚¯ã‚«ãƒ¼ãƒ‰ä¸€è¦§ -->
    <div *ngIf="filteredTasks.length > 0" class="tasks-grid">
      <mat-card
        *ngFor="let task of filteredTasks; trackBy: trackByTaskId"
        class="task-card"
        [ngClass]="getDueStatusClass(task)"
        (click)="onTaskClick(task)"
      >
        <!-- ã‚¿ã‚¹ã‚¯ãƒ˜ãƒƒãƒ€ãƒ¼ -->
        <mat-card-header>
          <div class="task-header">
            <h3 class="task-title">{{ task.taskName }}</h3>
            <div class="task-badges">
              <mat-chip
                class="priority-chip"
                [ngClass]="'priority-' + task.priority"
                selected
              >
                {{ task.priority }}
              </mat-chip>
              <mat-chip
                class="status-chip"
                [ngClass]="'status-' + task.status"
                selected
              >
                {{ task.status }}
              </mat-chip>
            </div>
          </div>
        </mat-card-header>

        <!-- ã‚¿ã‚¹ã‚¯å†…å®¹ -->
        <mat-card-content>
          <div class="task-info">
            <div class="project-info">
              <mat-icon>folder</mat-icon>
              <span
                class="project-name-pill"
                [ngStyle]="getProjectNameStyle(task)"
              >
                {{ task.projectName }}
              </span>
            </div>

            <div class="assignee-info">
              <mat-icon>person</mat-icon>
              <span>{{ task.assignee }}</span>
            </div>

            <div
              class="due-date-info"
              [class.overdue]="isOverdue(task.dueDate)"
              [class.due-today]="getDaysUntilDue(task.dueDate) === 0"
              [class.due-tomorrow]="getDaysUntilDue(task.dueDate) === 1"
              [class.due-soon]="isDueSoon(task.dueDate)"
            >
              <mat-icon>schedule</mat-icon>
              <span>{{ task.dueDate }}</span>
              <span class="days-until" *ngIf="!isOverdue(task.dueDate)">
                ({{ getDaysUntilDue(task.dueDate) }}æ—¥å¾Œ)
              </span>
              <span
                class="days-until overdue-text"
                *ngIf="isOverdue(task.dueDate)"
              >
                ({{ getAbsoluteValue(getDaysUntilDue(task.dueDate)) }}æ—¥é…ã‚Œ)
              </span>
            </div>
          </div>
        </mat-card-content>
      </mat-card>
    </div>
  </div>
</div>
