<h2>ã‚¬ãƒ³ãƒˆãƒãƒ£ãƒ¼ãƒˆå¼èª²é¡Œç®¡ç†</h2>

<!-- ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆé¸æŠã¨ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ -->
<div class="controls-section">
  <div class="project-selector">
    <h3>è¡¨ç¤ºã™ã‚‹ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’é¸æŠ</h3>
    <div class="project-checkboxes">
      <mat-checkbox
        *ngFor="let project of projects"
        [checked]="project.id ? isProjectSelected(project.id) : false"
        (change)="project.id ? toggleProjectSelection(project.id) : null"
        class="project-checkbox"
      >
        {{ project.projectName }}
      </mat-checkbox>
    </div>
    <div class="project-selection-actions">
      <button mat-stroked-button (click)="selectAllProjects()">
        ã™ã¹ã¦ã«ãƒã‚§ãƒƒã‚¯
      </button>
      <button mat-stroked-button (click)="clearProjectSelection()">
        ã™ã¹ã¦ã®ãƒã‚§ãƒƒã‚¯ã‚’ã‚¯ãƒªã‚¢
      </button>
    </div>
  </div>

  <!-- ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ -->
  <div class="filter-section">
    <mat-form-field appearance="outline" style="width: 150px">
      <mat-label>å„ªå…ˆåº¦</mat-label>
      <mat-select
        [(ngModel)]="filterPriority"
        (selectionChange)="applyFilters()"
      >
        <mat-option value="">ã™ã¹ã¦</mat-option>
        <mat-option value="é«˜">é«˜</mat-option>
        <mat-option value="ä¸­">ä¸­</mat-option>
        <mat-option value="ä½">ä½</mat-option>
      </mat-select>
    </mat-form-field>

    <mat-form-field appearance="outline" style="width: 150px">
      <mat-label>æ‹…å½“è€…</mat-label>
      <mat-select
        [(ngModel)]="filterAssignee"
        (selectionChange)="applyFilters()"
      >
        <mat-option value="">ã™ã¹ã¦</mat-option>
        <mat-option
          *ngFor="let assignee of getUniqueAssignees()"
          [value]="assignee"
        >
          {{ assignee }}
        </mat-option>
      </mat-select>
    </mat-form-field>

    <mat-form-field appearance="outline" style="width: 150px">
      <mat-label>ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</mat-label>
      <mat-select [(ngModel)]="filterStatus" (selectionChange)="applyFilters()">
        <mat-option value="">ã™ã¹ã¦</mat-option>
        <mat-option value="æœªç€æ‰‹">æœªç€æ‰‹</mat-option>
        <mat-option value="ä½œæ¥­ä¸­">ä½œæ¥­ä¸­</mat-option>
        <mat-option value="å®Œäº†">å®Œäº†</mat-option>
      </mat-select>
    </mat-form-field>

    <button mat-button (click)="resetFilters()">ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ãƒªã‚»ãƒƒãƒˆ</button>
  </div>
</div>

<!-- ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ -->
<div class="action-buttons">
  <button mat-raised-button color="primary" (click)="openProjectDialog()">
    + ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ
  </button>
</div>

<!-- ã‚¬ãƒ³ãƒˆãƒãƒ£ãƒ¼ãƒˆ -->
<div class="gantt-container">
  <!-- å‡¡ä¾‹ -->
  <div class="legend">
    <h4>ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</h4>
    <div class="legend-items">
      <div class="legend-item">
        <div class="legend-color" style="background-color: #ef9a9a"></div>
        <span>æœªç€æ‰‹</span>
      </div>
      <div class="legend-item">
        <div class="legend-color" style="background-color: #81c784"></div>
        <span>ä½œæ¥­ä¸­</span>
      </div>
      <div class="legend-item">
        <div class="legend-color" style="background-color: #64b5f6"></div>
        <span>å®Œäº†</span>
      </div>
    </div>
  </div>

  <!-- ã‚¬ãƒ³ãƒˆãƒãƒ£ãƒ¼ãƒˆæœ¬ä½“ -->
  <div class="gantt-chart">
    <!-- å·¦ãƒšã‚¤ãƒ³ï¼ˆå›ºå®šã‚«ãƒ©ãƒ ï¼‰ -->
    <div class="gantt-left-pane">
      <!-- å·¦ãƒ˜ãƒƒãƒ€ãƒ¼ -->
      <div class="gantt-header-left">
        <div class="header-cell">ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå</div>
        <div class="header-cell">ã‚¿ã‚¹ã‚¯å</div>
        <div class="header-cell">å„ªå…ˆåº¦</div>
        <div
          class="header-cell"
          [style.width.px]="assigneeColumnWidth"
          [style.min-width.px]="assigneeColumnWidth"
          [style.max-width.px]="assigneeColumnWidth"
          style="white-space: nowrap"
        >
          æ‹…å½“è€…
        </div>
      </div>
      <!-- å·¦ãƒœãƒ‡ã‚£ -->
      <div class="gantt-body-left">
        <div *ngFor="let task of tasks" class="task-row">
          <div
            class="task-info"
            [style.width.px]="totalInfoWidth"
            [style.min-width.px]="totalInfoWidth"
            [style.max-width.px]="totalInfoWidth"
          >
            <div
              class="info-cell project-name"
              [ngStyle]="getProjectNameStyle(task)"
            >
              {{ task.projectName }}
            </div>
            <div
              class="info-cell task-name clickable"
              (click)="openTaskDetail(task)"
            >
              {{ task.taskName }}
            </div>
            <div
              class="info-cell priority"
              [ngClass]="'priority-' + task.priority"
            >
              {{ task.priority }}
            </div>
            <div
              class="info-cell assignee"
              [style.width.px]="assigneeColumnWidth"
              [style.min-width.px]="assigneeColumnWidth"
              [style.max-width.px]="assigneeColumnWidth"
              style="white-space: nowrap"
            >
              {{ task.assignee }}
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- å³ãƒšã‚¤ãƒ³ï¼ˆã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³ï¼‰ -->
    <div class="gantt-right-pane">
      <!-- å³ãƒ˜ãƒƒãƒ€ãƒ¼ -->
      <div class="gantt-header-right">
        <!-- å¹´æœˆãƒ©ãƒ™ãƒ«è¡Œ -->
        <div class="year-month-labels-row">
          <div
            *ngFor="let group of getGroupedDates()"
            class="year-month-label"
            [style.width.px]="getYearMonthLabelWidth(group)"
          >
            {{ formatYearMonth(group.dates[0]) }}
          </div>
        </div>
        <!-- æ—¥ä»˜ã‚»ãƒ«è¡Œ -->
        <div class="date-cells-row">
          <div *ngFor="let date of dateRange" class="date-cell">
            {{ formatDay(date) }}
            <!-- ãƒã‚¤ãƒ«ã‚¹ãƒˆãƒ¼ãƒ³è¡¨ç¤º -->
            <div
              *ngFor="let milestone of getMilestonesForDate(date)"
              class="milestone-flag"
              (mouseenter)="showMilestoneTooltip($event, milestone)"
              (mouseleave)="hideMilestoneTooltip()"
            >
              ğŸš©
            </div>
          </div>
        </div>
      </div>
      <!-- å³ãƒœãƒ‡ã‚£ -->
      <div class="gantt-body-right">
        <div class="gantt-bars">
          <!-- å¹´æœˆãƒ©ãƒ™ãƒ«è¡Œã®ã‚¹ãƒšãƒ¼ã‚¹ -->
          <div class="year-month-labels-spacer-row">
            <div
              *ngFor="let group of getGroupedDates()"
              class="year-month-label-spacer"
              [style.width.px]="getYearMonthLabelWidth(group)"
            ></div>
          </div>
          <!-- èƒŒæ™¯ã®æ—¥ä»˜ã‚»ãƒ« -->
          <div class="date-cells-background">
            <div *ngFor="let date of dateRange" class="date-cell">
              <!-- æ—¥ä»˜ã‚»ãƒ« -->
            </div>
          </div>
          <!-- ã‚¿ã‚¹ã‚¯æœŸé–“ãƒãƒ¼ -->
          <ng-container *ngFor="let task of tasks; let i = index">
            <div
              *ngIf="task.startDate && task.dueDate"
              class="task-bar clickable"
              [style.background-color]="getTaskBarBackground(task)"
              [style.left]="getTaskBarStartPosition(task) + 'px'"
              [style.width]="getTaskBarWidth(task) + 'px'"
              [style.top]="i * 40 + 4 + 'px'"
              [title]="
                task.taskName +
                ' (' +
                task.status +
                ') - ' +
                task.startDate +
                ' ï½ ' +
                task.dueDate
              "
              (click)="openTaskDetail(task)"
            >
              <span class="task-bar-text">{{ task.taskName }}</span>
            </div>
          </ng-container>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- ã‚«ã‚¹ã‚¿ãƒ ãƒ„ãƒ¼ãƒ«ãƒãƒƒãƒ— -->
<div
  *ngIf="tooltipVisible"
  class="milestone-tooltip"
  [style.left.px]="tooltipPosition.x"
  [style.top.px]="tooltipPosition.y"
>
  <div class="tooltip-header">
    <span class="tooltip-icon">ğŸš©</span>
    <span class="tooltip-title">ãƒã‚¤ãƒ«ã‚¹ãƒˆãƒ¼ãƒ³</span>
  </div>
  <div class="tooltip-content">
    <div class="tooltip-project">{{ tooltipMilestone?.projectName }}</div>
    <div class="tooltip-name">{{ tooltipMilestone?.name }}</div>
    <div class="tooltip-date">
      {{ tooltipMilestone?.date | date : "yyyy/MM/dd" }}
    </div>
  </div>
  <div class="tooltip-arrow"></div>
</div>
