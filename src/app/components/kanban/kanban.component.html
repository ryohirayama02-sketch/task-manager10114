<h2 class="kanban-title">{{ 'kanban.title' | translate }}</h2>

<!-- プロジェクト選択 -->
<div class="project-selector">
  <h3>{{ 'kanban.projectSelector.title' | translate }}</h3>
  <div class="project-checkboxes">
      <mat-checkbox
        *ngFor="let project of projects"
        [(ngModel)]="selectedProjectIds"
        [value]="project.id"
        (ngModelChange)="onProjectSelectionChange()"
        class="project-checkbox"
      >
        {{ project.projectName }}
      </mat-checkbox>
  </div>
  <div class="project-selection-actions">
    <button mat-stroked-button (click)="selectAllProjects()">
      {{ 'kanban.projectSelector.selectAll' | translate }}
    </button>
    <button mat-stroked-button (click)="clearProjectSelection()">
      {{ 'kanban.projectSelector.clearAll' | translate }}
    </button>
  </div>
</div>

<div
  style="
    display: flex;
    justify-content: flex-end;
    margin-bottom: 16px;
    gap: 8px;
  "
>
  <button mat-raised-button color="primary" (click)="openProjectDialog()">
    {{ 'kanban.createProject' | translate }}
  </button>
  <button
    mat-raised-button
    color="accent"
    (click)="openTaskDialog()"
    [disabled]="selectedProjectIds.length !== 1"
  >
    {{ 'kanban.createTask' | translate }}
  </button>
</div>

<div class="kanban-board">
  <div
    *ngFor="let status of statuses"
    class="status-column"
    [ngClass]="'status-' + status"
  >
    <div class="status-header">
      <h3>{{ status }}</h3>
      <span class="task-count">({{ filterByStatus(status).length }})</span>
    </div>
    <div class="task-list">
      <div
        *ngFor="let task of filterByStatus(status)"
        class="task-card"
        (click)="openTaskDetail(task)"
      >
        <div class="task-header">
          <b class="task-name-link">{{ task.taskName }}</b>
          <div class="status-buttons">
            <button
              *ngFor="let status of statuses"
              mat-mini-fab
              [color]="task.status === status ? 'primary' : 'basic'"
              (click)="
                task.id ? changeTaskStatus(task.id, status) : null;
                $event.stopPropagation()
              "
              [disabled]="task.status === status"
              class="status-button"
            >
              {{ status.charAt(0) }}
            </button>
          </div>
        </div>
        <div class="task-details">
          <div class="project-name">
            <mat-icon class="project-icon">folder</mat-icon>
            <span class="project-name-text">
              {{ task.projectName }}
            </span>
          </div>
          <div class="task-meta">
            <span *ngIf="task.dueDate">{{ 'kanban.dueDate' | translate }}: {{ task.dueDate }}</span>
            <span *ngIf="task.assignee">{{ 'kanban.assignee' | translate }}: {{ task.assignee }}</span>
          </div>
          <div class="priority" [ngClass]="'priority-' + task.priority">
            {{ task.priority }}
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
